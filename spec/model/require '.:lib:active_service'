require './lib/active_service'

ActiveService::API.setup :url => "https://api.example.com"
# api1 = ActiveService::API.new :url => "https://api1.example.com"

class User < ActiveService::Base; end



api = ActiveService::API.setup :url => "https://api.example.com" do |builder|
  builder.adapter :test do |stub|
    stub.get("/users") { |env| ok! [{ :id => 1 }] }
    stub.get("/users/1") { |env| [200, {}, { :id => 1 }.to_json] }
    stub.post("/users") { |env| [200, {}, { :id => 1 }.to_json] }
    stub.get("/users/popular") do |env|
      if env[:params]["page"] == "2"
        [200, {}, [{ :id => 3 }, { :id => 4 }].to_json]
      else
        [200, {}, [{ :id => 1 }, { :id => 2 }].to_json]
      end
    end          
  end
end

class User < ActiveService::Base
  use_api api
end
